<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Prize Merchandise - Ma Chung</title>
    <style>
        :root {
            --mc-blue: #004a99;
            --mc-green: #28a745;
            --mc-dark: #002d5e;
            --white: #ffffff;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--mc-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center; 
            color: white;
            position: relative;
            overflow: hidden;
        }

        .bg-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('image-7 (1).png'); 
            background-size: cover; background-position: center;
            z-index: -2;
        }

        .blue-tint {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 74, 153, 0.75); 
            z-index: -1;
        }

        /* --- HP: LOGO NANG PLUNGKERAN IJO --- */
        .logo-top {
            position: absolute;
            top: 6vh; 
            width: 85px; 
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            cursor: pointer;
            z-index: 100;
        }

        .container { 
            text-align: center; 
            z-index: 10; 
            width: 100%;
            max-width: 600px;
            padding: 10px;
            display: flex; flex-direction: column;
            align-items: center;
            gap: 12px; 
        }

        .main-title { 
            margin: 0; 
            font-size: 5vw; /* ONE LINE PASTI */
            font-weight: 900;
            text-transform: uppercase; 
            color: var(--white);
            text-shadow: 2px 2px 0px var(--mc-green);
            white-space: nowrap; 
            letter-spacing: 0.5px;
        }

        /* LOTRE TAK CILIKNO BEN GAK MENONJOL */
        #card-wrapper {
            position: relative;
            width: 85%;
            max-width: 420px; 
            aspect-ratio: 550 / 320;
            background: var(--mc-blue); 
            border-radius: 15px;
            border: 5px solid var(--mc-green);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        #prize-content {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: var(--mc-blue);
        }

        #prize-name { 
            font-size: 1.25rem; 
            font-weight: 900; 
            background: var(--mc-green); 
            padding: 8px 18px;
            border: 3px solid var(--white); 
            border-radius: 10px;
            text-transform: uppercase;
        }

        #scratch-canvas { 
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%;
            z-index: 5; 
        }

        #visual-hand {
            position: absolute; width: 140px; 
            z-index: 99; pointer-events: none;
            top: 110%; left: 50%;
            transform: translateX(-50%);
            transition: top 0.5s ease-out, opacity 0.5s ease-out;
        }

        .btn-action {
            margin-top: 5px;
            padding: 12px 40px;
            font-size: 1.15rem;
            font-weight: bold;
            background: var(--mc-green);
            color: white;
            border: none;
            border-radius: 50px;
            box-shadow: 0 5px 0 #1a6d2d;
            cursor: pointer;
            transition: 0.1s;
        }

        /* --- TOMBOL MATI: IRENG PEKAT (OCD PRO) --- */
        .btn-action:disabled {
            background: #111111 !important; 
            color: #444444 !important;
            box-shadow: none !important;
            cursor: not-allowed;
            transform: translateY(4px); /* Efek mendlep pas diklik */
        }

        /* --- LAPTOP: FIX OVERLAP --- */
        @media (min-width: 768px) {
            .logo-top { 
                position: static; 
                width: 120px; 
                margin-bottom: 5px; 
            }
            .container { gap: 10px; }
            .main-title { font-size: 2.2rem; }
            #prize-name { font-size: 2.5rem; }
            .btn-action { font-size: 1.6rem; padding: 15px 50px; }
            #visual-hand { width: 240px; }
        }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>
    <div class="blue-tint"></div>

    <div class="container">
        <img src="logo-umc.png" class="logo-top" id="admin-logo" alt="Logo Ma Chung">
        <h1 class="main-title">LUCKY PRIZE MERCHANDISE</h1>

        <div id="card-wrapper">
            <div id="prize-content">
                <p id="prize-name"></p>
                <p id="prize-sub"></p>
            </div>
            <canvas id="scratch-canvas"></canvas>
            <img id="visual-hand" src="Sales_Product_Website-removebg-preview.png" alt="Hand Anim">
        </div>

        <button class="btn-action" id="btn-play" onclick="executeScratch()">GOSOK SEKARANG!</button>
    </div>

    <audio id="snd-scratch" loop src="scrubbing-69126.mp3"></audio>
    <audio id="snd-win" src="https://www.soundjay.com/human/applause-01.mp3"></audio>
    <audio id="snd-lose" src="https://www.soundjay.com/misc/sounds/fail-trombone-01.mp3"></audio>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        const hand = document.getElementById('visual-hand');
        const btn = document.getElementById('btn-play');
        const sndScratch = document.getElementById('snd-scratch');
        const adminLogo = document.getElementById('admin-logo');

        const STOCK_KEY = 'umc_expo_v_final_standard_fix_v3'; 
        
        let storage = JSON.parse(localStorage.getItem(STOCK_KEY)) || {
            "KIPAS TANGAN UMC": 5, 
            "STIKER UMC": 25, 
            "BOLPOINT UMC": 5
        };

        let clickCount = 0;

        function resizeCanvas() {
            const wrapper = document.getElementById('card-wrapper');
            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;
            init(); 
        }

        function init() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#bdc3c7'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for(let i=0; i<300; i++) {
                ctx.fillStyle = Math.random() > 0.5 ? '#abb2b9' : '#d5d8dc';
                ctx.beginPath();
                ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height, 1, 0, Math.PI*2);
                ctx.fill();
            }
            ctx.font = `bold ${canvas.width/15}px Arial`;
            ctx.fillStyle = "#7f8c8d";
            ctx.textAlign = "center";
            ctx.fillText("GOSOK DI SINI", canvas.width/2, canvas.height/1.8);
        }

        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);

        function executeScratch() {
            btn.disabled = true; // Langsung dadi ireng
            const result = calculateResult();
            document.getElementById('prize-name').innerText = result.name;
            document.getElementById('prize-sub').innerText = result.win ? "Selamat! Ambil merchandise ke panitia stand." : "Maaf ya, belum beruntung.";
            hand.style.top = "50%"; 
            setTimeout(() => {
                sndScratch.play();
                startAutoScratch(result.win);
            }, 500);
        }

        function calculateResult() {
            const totalStock = Object.values(storage).reduce((a, b) => a + b, 0);
            const winChance = Math.random() < 0.17 && totalStock > 0;
            if (winChance) {
                let pool = [];
                for (const [name, count] of Object.entries(storage)) {
                    if (count > 0) pool.push(name);
                }
                if (pool.length > 0) {
                    const picked = pool[Math.floor(Math.random() * pool.length)];
                    storage[picked]--;
                    localStorage.setItem(STOCK_KEY, JSON.stringify(storage));
                    return { win: true, name: picked };
                }
            }
            return { win: false, name: 'ZONK ðŸ¤ª' };
        }

        function startAutoScratch(isWin) {
            ctx.globalCompositeOperation = 'destination-out';
            hand.style.transition = 'none';
            hand.style.transform = 'none';
            let start = null;
            const duration = 2800; 
            function animate(now) {
                if (!start) start = now;
                const progress = now - start;
                const x = (progress / duration) * (canvas.width + 100);
                const y = (canvas.height/2) + Math.sin(progress * 0.015) * (canvas.height/3);
                ctx.beginPath(); ctx.arc(x, y, canvas.width/8, 0, Math.PI * 2); ctx.fill();
                hand.style.left = (x - (hand.offsetWidth/4)) + 'px';
                hand.style.top = (y - (hand.offsetHeight/1.5)) + 'px';
                if (progress < duration) requestAnimationFrame(animate);
                else onFinish(isWin);
            }
            requestAnimationFrame(animate);
        }

        function onFinish(isWin) {
            sndScratch.pause();
            sndScratch.currentTime = 0;
            hand.style.opacity = '0';
            canvas.style.opacity = '0';
            if (isWin) {
                document.getElementById('snd-win').play();
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
            } else {
                document.getElementById('snd-lose').play();
            }
            setTimeout(() => { location.reload(); }, 6000);
        }

        adminLogo.addEventListener('click', () => {
            clickCount++;
            if (clickCount === 3) {
                let currentStr = Object.entries(storage).map(([n, c]) => `${n}:${c}`).join(', ');
                let input = prompt(`DATABASE ADMIN\nFormat: NAMA:JUMLAH`, currentStr);
                if (input) {
                    try {
                        let newStorage = {};
                        input.split(',').forEach(item => {
                            let [name, count] = item.split(':');
                            newStorage[name.trim().toUpperCase()] = parseInt(count.trim());
                        });
                        storage = newStorage;
                        localStorage.setItem(STOCK_KEY, JSON.stringify(storage));
                        location.reload();
                    } catch (e) { alert("Format Salah!"); }
                }
                clickCount = 0;
            }
            setTimeout(() => { clickCount = 0; }, 2000);
        });
    </script>
</body>
</html>