<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Prize Merchandise - Ma Chung</title>
    <style>
        :root {
            --mc-blue: #004a99;
            --mc-green: #28a745;
            --mc-dark: #002d5e;
            --white: #ffffff;
        }

        * { box-sizing: border-box; } /* Biar padding gak ngerusak ukuran */

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background-image: url('image-7 (1).png');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed; /* Biar background gak ikut scroll */
            background-repeat: no-repeat;
            min-height: 100vh; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: white;
            position: relative;
        }

        /* OVERLAY BIAR BACKGROUND TETEP SAMAR */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 74, 153, 0.75); 
            z-index: 0;
        }

        .container { 
            text-align: center; 
            z-index: 10; 
            width: 100%;
            max-width: 600px; /* Batas maksimal biar gak kelebaran di laptop */
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px; 
        }

        .logo-top {
            width: 100px; 
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            margin: 0 auto;
        }

        .main-title { 
            margin: 0 0 10px 0; 
            font-size: 1.8rem; /* Ukuran default lebih kecil (mobile-first) */
            font-weight: 900;
            text-transform: uppercase; 
            color: var(--white);
            text-shadow: 2px 2px 0px var(--mc-green);
            letter-spacing: 1px;
        }

        /* CARD JADI RESPONSIF */
        #card-wrapper {
            position: relative;
            width: 100%; /* Ikuti lebar layar HP */
            max-width: 550px; /* Tapi jangan lebih dari 550px di laptop */
            aspect-ratio: 550 / 320; /* Jaga proporsi kotak */
            background: var(--mc-blue); 
            border-radius: 15px;
            border: 6px solid var(--mc-green);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
            margin: 0 auto;
        }

        #prize-content {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: var(--mc-blue);
            text-align: center;
            padding: 10px;
        }

        #prize-name { 
            font-size: 1.5rem; /* Ukuran nama hadiah di HP */
            font-weight: 900; 
            margin: 0; 
            color: var(--white); 
            text-transform: uppercase;
            background: var(--mc-green); 
            padding: 10px 20px;
            border: 3px solid var(--white); 
            border-radius: 10px;
            display: inline-block;
        }

        #prize-sub { 
            font-size: 1rem; 
            color: #e0e0e0; 
            margin-top: 15px; 
        }

        #scratch-canvas { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; /* Canvas ikut ukuran wrapper */
            z-index: 5; 
        }

        #visual-hand {
            position: absolute;
            width: 200px; /* Tangan dikecilkan buat HP */
            z-index: 99;
            pointer-events: none;
            top: 110%; 
            left: 50%;
            transform: translateX(-50%);
            transition: top 0.5s ease-out, opacity 0.5s ease-out;
        }

        .btn-action {
            margin: 10px auto 0;
            padding: 12px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            background: var(--mc-green);
            color: white;
            border: none;
            border-radius: 50px;
            box-shadow: 0 5px 0 #1a6d2d;
            cursor: pointer;
            transition: 0.2s;
        }

        /* --- PENYESUAIAN KHUSUS LAPTOP (LAYAR GEDE) --- */
        @media (min-width: 768px) {
            .logo-top { width: 130px; }
            .main-title { font-size: 2.5rem; }
            #prize-name { font-size: 2.5rem; padding: 15px 35px; }
            #prize-sub { font-size: 1.3rem; }
            .btn-action { font-size: 1.6rem; padding: 15px 50px; }
            #visual-hand { width: 270px; }
        }

        .zoom-in-out { animation: zoom 0.5s infinite alternate; }
        @keyframes zoom { from { transform: scale(1); } to { transform: scale(1.05); } }
    </style>
</head>
<body>

    <div class="container">
        <img src="logo-umc.png" class="logo-top" alt="Logo Ma Chung">
        <h1 class="main-title">LUCKY PRIZE MERCHANDISE</h1>

        <div id="card-wrapper">
            <div id="prize-content">
                <p id="prize-name"></p>
                <p id="prize-sub"></p>
            </div>
            <canvas id="scratch-canvas"></canvas>
            <img id="visual-hand" src="Sales_Product_Website-removebg-preview.png" alt="Hand Anim">
        </div>

        <button class="btn-action" id="btn-play" onclick="executeScratch()">GOSOK SEKARANG!</button>
    </div>

    <audio id="snd-scratch" loop src="scrubbing-69126.mp3"></audio>
    <audio id="snd-win" src="https://www.soundjay.com/human/applause-01.mp3"></audio>
    <audio id="snd-lose" src="https://www.soundjay.com/misc/sounds/fail-trombone-01.mp3"></audio>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        const hand = document.getElementById('visual-hand');
        const btn = document.getElementById('btn-play');
        const sndScratch = document.getElementById('snd-scratch');

        const STOCK_KEY = 'umc_expo_final_framed_v3';
        let storage = JSON.parse(localStorage.getItem(STOCK_KEY)) || {
            kipas: 5, stiker: 25, bolpoint: 5, totalWin: 0
        };

        // Fungsi untuk mengatur resolusi canvas agar pas dengan ukuran wrapper
        function resizeCanvas() {
            const wrapper = document.getElementById('card-wrapper');
            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;
            init(); // Re-draw lapisan abu-abu
        }

        function init() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#bdc3c7'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for(let i=0; i<400; i++) {
                ctx.fillStyle = Math.random() > 0.5 ? '#abb2b9' : '#d5d8dc';
                ctx.beginPath();
                ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height, 1, 0, Math.PI*2);
                ctx.fill();
            }
            ctx.font = `bold ${canvas.width/18}px Arial`;
            ctx.fillStyle = "#7f8c8d";
            ctx.textAlign = "center";
            ctx.fillText("GOSOK DI SINI", canvas.width/2, canvas.height/1.8);
        }

        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);

        function executeScratch() {
            btn.disabled = true;
            const result = calculateResult();
            document.getElementById('prize-name').innerText = result.name;
            document.getElementById('prize-sub').innerText = result.win ? "Selamat! Ambil di stand kami." : "Maaf ya, belum beruntung.";
            hand.style.top = "50%"; 
            setTimeout(() => {
                sndScratch.play();
                startAutoScratch(result.win);
            }, 500);
        }

        function calculateResult() {
            const winChance = Math.random() < 0.08 && storage.totalWin < 35;
            if (winChance) {
                let pool = [];
                if (storage.kipas > 0) pool.push('KIPAS TANGAN');
                if (storage.stiker > 0) pool.push('STIKER EXCLUSIVE');
                if (storage.bolpoint > 0) pool.push('BOLPOINT UMC');
                if (pool.length > 0) {
                    const picked = pool[Math.floor(Math.random() * pool.length)];
                    if (picked === 'KIPAS TANGAN') storage.kipas--;
                    else if (picked === 'BOLPOINT UMC') storage.bolpoint--;
                    else storage.stiker--;
                    storage.totalWin++;
                    localStorage.setItem(STOCK_KEY, JSON.stringify(storage));
                    return { win: true, name: picked };
                }
            }
            return { win: false, name: 'ZONK ðŸ˜¢' };
        }

        function startAutoScratch(isWin) {
            ctx.globalCompositeOperation = 'destination-out';
            hand.style.transition = 'none';
            hand.style.transform = 'none';
            let start = null;
            const duration = 2800; 
            function animate(now) {
                if (!start) start = now;
                const progress = now - start;
                const x = (progress / duration) * (canvas.width + 100);
                const y = (canvas.height/2) + Math.sin(progress * 0.015) * (canvas.height/3);
                ctx.beginPath(); ctx.arc(x, y, canvas.width/10, 0, Math.PI * 2); ctx.fill();
                hand.style.left = (x - (hand.offsetWidth/4)) + 'px';
                hand.style.top = (y - (hand.offsetHeight/1.5)) + 'px';
                if (progress < duration) requestAnimationFrame(animate);
                else onFinish(isWin);
            }
            requestAnimationFrame(animate);
        }

        function onFinish(isWin) {
            sndScratch.pause();
            sndScratch.currentTime = 0;
            hand.style.transition = 'opacity 0.4s ease-out';
            hand.style.opacity = '0';
            canvas.style.transition = 'opacity 0.8s ease-out';
            canvas.style.opacity = '0';
            if (isWin) {
                document.getElementById('snd-win').play();
                document.getElementById('prize-name').classList.add('zoom-in-out');
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
            } else {
                document.getElementById('snd-lose').play();
            }
            setTimeout(() => { location.reload(); }, 6000);
        }

        window.addEventListener('keydown', (e) => {
            if(e.key.toLowerCase() === 'r') {
                if(confirm("Yakin mau reset semua stok hadiah?")) {
                    localStorage.removeItem(STOCK_KEY);
                    location.reload();
                }
            }
        });
    </script>
</body>
</html>